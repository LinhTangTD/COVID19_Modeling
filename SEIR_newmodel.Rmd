---
title: "New SEIR model (+QHD)"
author: "Linh Tang"
date: "2/27/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
# Population is split into 2 sub-populations:
# Vulnerable (V) and Non-Vulnerable (NV)
N = 1000
p.vulnerable = .0
N.v = N * p.vulnerable
N.nv = N - N.v

# Parameters Declaration for NV sub-population

### Mutable Parameters (Testing effectiveness, quarantine days)
p.test.sym = 0 #percentage of testing for symptomatic group
p.test.asym = 0 #percentage of testing for asymptomatic group
p.test.all = p.test.asym/2 #percentage of testing for all NV sub-population
p.fp.all = .01 #false positive percentage of testing for all NV sub-population
p.tp.sym = .98 #true positive percentage for symptomatic group
p.tp.asym = .95 #true positive percentage for asymptomatic group
day.q = 14 #quarantine period (days)

### Immutatble Parameters (disease's rates)
p.ns = .25 #percentage of initial non-susceptible
p.sym = .5 #percentage of infected being symptomatic
day.i = 10 #incubation period (days)
E.rate = 1 / day.i #exposure rate

I.rate.sym = 1 #infection rate for symptomatic group
I.rate.asym = 1 #infection rate for asymptomatic group

H.rate = .1 #hospitalization rate

R.rate.sym = .09 #recovery rate for symptomatic group
R.rate.asym = .1 #recovery rate for asymptomatic group
R.rate.h = .05333 #recovery rate for hospitalized group

D.rate.sym = .01 #death rate for symptomatic group
D.rate.asym = .05 #death rate for asymptomatic group
D.rate.h = 0.01333 #death rate for hospitalized group

### Initial setting (day 0)
Isym = 5 #initial infected symptomatic
Iasym = 0 #initial infected asymptomatic
I = Isym + Iasym #total infected
R = N.nv * p.ns #initial "recovered" i.e non-susceptible
S = N.nv - I - R
FQ = 0
E = 0
D = 0
H = 0
Qsym = 0
Qasym = 0
Q = Qsym + Qasym #total quarantined
```

```{r}
df = data.frame(Day = numeric(), 
                S = numeric(), 
                E = numeric(), 
                Isym = numeric(), 
                Iasym = numeric(), 
                Qsym = numeric(), 
                Qasym = numeric(), 
                H = numeric(), 
                R = numeric(), 
                D = numeric())
df[1,] = list(0, S, E, Isym, Iasym, Qsym, Qasym, H, R, D)
for (i in 1:100) {
  ### Immediate calculations
  new.exposed = (S/N) * (I.rate.sym * Isym + I.rate.asym * Iasym)
  quarantine.released.today = FQ/day.q
  new.quarantined = S * p.test.all * p.fp.all
  new.infected = E.rate * E
    # infected symptomatic
  new.infected.sym = new.infected * p.sym
  confirmed.sym = Isym * p.test.sym * p.tp.sym
  nonconfirmed.sym = Isym - confirmed.sym
    # infected asymptomatic
  new.infected.asym = new.infected - new.infected.sym
  confirmed.asym = Iasym * p.test.asym * p.tp.asym
  nonconfirmed.asym = Iasym - confirmed.asym
    # transition between compartments (I, Q, H, R, D)
  nonconfirmed.sym.to.H = nonconfirmed.sym * H.rate
  nonconfirmed.sym.to.R = nonconfirmed.sym * R.rate.sym
  nonconfirmed.sym.to.D = nonconfirmed.sym * D.rate.sym
  nonconfirmed.asym.to.R = nonconfirmed.asym * R.rate.asym
  Qsym.to.H = Qsym * H.rate
  Qsym.to.R = Qsym * R.rate.sym
  Qsym.to.D = Qsym * D.rate.sym
  Qasym.to.R = Qasym * R.rate.asym
  H.to.R = H * R.rate.h
  H.to.D = H * D.rate.h
  
  ### Calculate changes in each compartment
  dS = - new.exposed - new.quarantined + quarantine.released.today
  dFQ = new.quarantined - quarantine.released.today
  dE = new.exposed - new.infected
  
  dIsym = new.infected.sym - confirmed.sym - nonconfirmed.sym.to.H - nonconfirmed.sym.to.R - nonconfirmed.sym.to.D
  dIasym = new.infected.asym - confirmed.asym - nonconfirmed.asym.to.R
  dQsym = confirmed.sym - Qsym.to.H - Qsym.to.R - Qsym.to.D
  dQasym = confirmed.asym - Qasym.to.R
  dH = H.rate * (nonconfirmed.sym + Qsym) - H * (R.rate.h + D.rate.h)
  dR = H.to.R + nonconfirmed.sym.to.R + Qsym.to.R + Qasym.to.R +  nonconfirmed.asym.to.R
  dD = H.to.D * H + nonconfirmed.sym.to.D + Qsym.to.D
  
  ### Final calculations
  S = S + dS
  FQ = FQ + dFQ
  E = E + dE
  Isym = Isym + dIsym
  Iasym = Iasym + dIasym
  Qsym = Qsym + dQsym
  Qasym = Qasym + dQasym
  H = H + dH
  R = R + dR
  D = D + dD
  df[i+1,] = list(i, S, E, Isym, Iasym, Qsym, Qasym, H, R, D)
}
```